---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pagination from '../../components/Pagination.astro';
import { PAGE_SIZE } from '../../config';

export async function getStaticPaths({ paginate }) {
  const posts = (await getCollection('posts')).sort((a, b) =>
    new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  );

  return paginate(posts, { pageSize: PAGE_SIZE });
}

const { page } = Astro.props;

// Redirect Page 1 to root to avoid duplicate content
if (page.currentPage === 1) {
  return Astro.redirect('/');
}
---

<BaseLayout title={`第 ${page.currentPage} 页 - 文章列表`} showHomeLink={true}>
  <section class="mb-12">
    <h1 class="text-3xl font-serif font-bold tracking-tight mb-4">文章列表</h1>
    <p class="text-sm opacity-50">第 {page.currentPage} 页，共 {page.lastPage} 页</p>
  </section>

  <main class="space-y-16">
    {page.data.map((post, index) => (
      <>
        <article class="group cursor-pointer">
          <a href={`/posts/${post.slug}`}>
            <h2 class="text-xl font-serif font-semibold group-hover:text-accent transition-colors mb-1">
              {post.data.title}
            </h2>
            <time class="text-xs uppercase tracking-widest opacity-50 block mb-3">{post.data.date}</time>
            <p class="opacity-70 leading-relaxed mb-3">
              {post.data.description}
            </p>
            <span class="text-sm border-b border-accent/30 group-hover:border-accent pb-0.5 transition-colors">阅读全文 →</span>
          </a>
        </article>
        {index < page.data.length - 1 && <hr class="border-ink/10 dark:border-moon/10" />}
      </>
    ))}
  </main>

  <Pagination
    current={page.currentPage}
    total={page.lastPage}
    prevUrl={page.url.prev === '/page/1' ? '/' : page.url.prev}
    nextUrl={page.url.next}
  />
</BaseLayout>
